# 数据链路层

1. 数据链路层基本概念及基本问题
	* 基本概念
	* 三个基本问题

2. 两种情况下的数据链路层
	* 使用点对点信道的数据链路层（PPP协议）
	* 使用广播信道的数据链路层（局域以太网LAN）

3. 以太网
	* 扩展以太网
	* 虚拟以太网（VLAN）
	* 高速以太网

***
### 1、基本概念
* **信道类型**
	
	* 点对点信道
	* 广播信道

* **链路**（物理链路）
* **数据链路**：通过协议来控制数据的传输，实现硬件和软件
	* 现最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件
	* 一般的适配器都包括了数据链路层和物理层的功能
* **帧**

***
### 2、三个基本问题

1. **封装成帧**就是在一段数据的前后分别添加首部和尾部，进行帧的界定。

2. **透明传输**在发送时加转义字符；在接收端的数据链路层送往网络层之前**删除**插入的**转义字符**，所以叫透明传输

3. **差错控制**

* **比特差错**

	* 传输过程中可能会产生**比特差错**：1可能变成0，0可能变成1
	
	* 在一段时间内，传输错误的比特占所传输比特总数的比率称为**误码率BER**（和信噪比有很大关系）
	
	* **循环冗余校验CRC**（计算过程）
		
		* **帧检验序列FCS**
		
		* **无差错接受**：凡是接收到的数据链路层接受的帧都没有传输差错 **【有差错的帧就丢弃而不接受】**，是一种无比特差错，而不是无传输差错的检测机制。

* **传输差错**：帧丢失、帧重复或帧失序

***
### 3、点对点信道（PPP协议）

* **概念**：用户计算机和ISP进行通信时所使用的数据链路层协议

* **特点**：

	* 需要拨号上网
	* 不使用序号和确认机制

* **三个组成部分**：

	* 高级数据链路控制协议（HDLC）
	* 链路控制协议（LCP）
	* 网络控制协议（NCP）（针对每一个网络层协议）

* **帧格式**

* **透明传输**

	* 字节填充（传输字节）
	* 零比特填充方法（传输比特流）

* **工作状态**

#### 【实验】[配置路由器接口使用PPP协议](https://blog.csdn.net/qq_38151401/article/details/104947753)

```
en/enable	//进入特权模式

config -t 	//进入全局配置模式

hostname RouteA 	//修改路由器名称

interface serial 2/0	//配置以太网接口

clock rate 64000	//时钟频率

ip address 172.16.1.1	255.255.255.0 	//配置IP

no shutdown	//启用

encapsulation ppp	//修改为PPP协议

username RouterB password todd	//ppp中数据链路层安全-身份验证（共享秘钥）

ppp authentication chap	//chap验证方式

```

***
### 4、广播信道的多点接入（以太局域网）

1. **局域网**

	1. **拓扑**：星型网、总线网、环形网、树形网
	2. **特点**：一个单位所拥有，地理范围和站点受限
	3. **优点**：
		1. 具有广播功能
		2. 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变
		3. 提高了系统的可靠性、可用性和生存性

2. **广域网**：花钱租宽带

3. **共享通信媒体**
	
	1. 静态划分信道：频分复用、时分复用、波分复用、码分复用
	2. 动态媒体接入控制：随机接入（以太网）、受控接入

4. **CSMA/CD协议**【载波监听多点接入/碰撞检测（Carrier Sense Mutiple）】

	1. **多点接入**
	2. **载波监听**
	3. **碰撞检测**
	
	* 使用CSMA/CD协议的以太网不能进行全双工通信而只能进行**半双工通信**
	* 以太网冲突检测
	* 最短有效帧长
	* 避让机制【二进制指数类型退避算法】

5. 以太网
	1. DIX Ethernet V2标准
	2. IEEE的802.3标准：拆分为两个子层
		* 逻辑链路控制子层（LLC）【已经不使用了】
		* 媒体接入控制子层（MAC）
6. 集线器
	* 使用**CSMA/CD协议**，工作在物理层
	* 10Base-T(10Mb/s)

7. 以太网的信道利用率

8. MAC层（MAC地址、MAC帧）

*	【实验一】更改MAC地址
* 【实验二】MAC帧格式---学会使用抓包工具（wireshark）
	
```
Frame //帧

Ethernet//目标MAC地址、源MAC地址

Internet Protocol Version 6//目标IP地址、源IP地址

Transmission Control Protocol//端口、有效数据
```
* 无效的MAC帧（4点）
* 帧间最小间隔（9.6us），相当于96bit的发送时间 
	
	
***
### 5、扩展以太网

1. **网桥**
	1. 概念（内部结构）
	2. 好处和坏处
	3. 透明网桥---使用了生成树算法（为了避免产生转发的帧在网络中不断地兜圈子）
	4. 自学习算法

#### 【实验】[更改生成树的根（优先级）](https://blog.csdn.net/qq_38151401/article/details/104977316)
```
spann-tree vlan 1 priority ?(4096)	//更改优先级
```

2. **交换机**
	1. 多端口的网桥、高速的网桥
	2. 安全、高速
#### 【实验】[交换机动态学习mac地址](https://blog.csdn.net/qq_38151401/article/details/104976239)
```
show mac address-table
```

***

3. **虚拟局域网VLAN**

	1. 【概念】一个VLAN = 一个广播域 = 逻辑网段（子网）

	2. 【用途】可使网络按照部门进行划分

#### 【实验】[验证VLAN（划分虚拟局域网）](https://blog.csdn.net/qq_38151401/article/details/104983531)

```
show vlan //显示VLAN

vlan 2 //添加vlan2

interface range fastEthernet 0/13 - 24 //获取接口范围

switchport access vlan 2 //将接口放到vlan2中
```

3. [交换机上的VLAN**干道链路**、访问链路](https://lihaiyu.blog.csdn.net/article/details/105477263)

	1. 如果需要跑多个VLAN，需要配置成干道链路；否则配置为访问链路；

	2. 干道链路实现：在帧格式中加标记--干道端口、中继端口

		* ISL标记、ISL封装---在以太网帧格式中插入4字节的VLAN标记

	3. 使用统计时分复用

### 6、高速以太网

1. 100Base-T

	1. 特点
	2. 物理层标准

2. 吉比特以太网

	1. 特点
	2. 物理层标准
	3. 配置举例（吉比特交换集线器）

3. 建网3层模型（网络改造）

	1. 核心层
	2. 汇聚层
	3. 接入层

#### 【实验】[宽带接入（在交换机上实现的接入安全）](https://blog.csdn.net/qq_38151401/article/details/104985904)

```
config -t //进入全局配置模式

interface range fastEthernet 0/1 - 4 //这种方式可以配置接口1-4

switchport mode access //将交换机端口设置为access，明确该端口连接的是计算机

switchport port-security //在交换机端口启用安全

switchport port-security violation shutdown //违反安全规则后接口禁用

switchport port-security mac-address sticky //将上面的动态的MAC地址和端口进行绑定

show mac address-table //查看MAC地址表
```



